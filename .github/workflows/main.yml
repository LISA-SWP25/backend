name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  check:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Check if app starts
      run: |
        echo "üöÄ –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è..."
        timeout 10 python -c "
        try:
            import main
            print('‚úÖ main.py –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ')
        except Exception as e:
            print(f'‚ùå –û—à–∏–±–∫–∞: {e}')
            exit(1)
        " || echo "‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
        
    - name: Run tests (if exist)
      run: |
        pip install pytest
        echo "üß™ –ò—â–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã..."
        
        if [ -f "test_api.py" ]; then
          echo "üìç –ù–∞–π–¥–µ–Ω test_api.py"
          pytest test_api.py -v
        elif [ -f "tests/test_api.py" ]; then
          echo "üìç –ù–∞–π–¥–µ–Ω tests/test_api.py"
          pytest tests/test_api.py -v
        elif [ -d "tests" ]; then
          echo "üìç –ù–∞–π–¥–µ–Ω–∞ –ø–∞–ø–∫–∞ tests"
          pytest tests/ -v
        else
          echo "‚ö†Ô∏è –¢–µ—Å—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, —Å–æ–∑–¥–∞–π—Ç–µ test_api.py"
          echo "‚úÖ –ù–æ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, CI –ø—Ä–æ—Ö–æ–¥–∏—Ç"
        fi
        
    - name: Success
      run: echo "üéâ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã!"
